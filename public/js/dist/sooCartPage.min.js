var fadeTime=300;function moo_updateCartTotal(){jQuery(".moo_cart_total > td:last").html("Calculating...");jQuery.post(moo_params.ajaxurl,{action:"moo_cart_getTotal"},function(data){if(data!==false){if(data.total===0||Object.keys(MOO_CART).length===0){jQuery(".moo_cart_total").remove();return}html="<tr class='moo_cart_total'>";html+="<td colspan='1' style='text-align: right;'>Subtotal:</td>";html+="<td colspan='3'>$"+mooformatCentPrice(data.sub_total)+"</td>";html+="</tr>";if(data.coupon_value>0){html+="<tr  class='moo_cart_total'>";html+="<td colspan='1' style='text-align: right; color: green'>"+data.coupon_name+":</td>";html+="<td colspan='3'>- $"+mooformatCentPrice(data.coupon_value)+"</td>";html+="</tr>"}html+="<tr  class='moo_cart_total'>";html+="<td colspan='1' style='text-align: right;'>Tax:</td>";html+="<td colspan='3'>$"+mooformatCentPrice(data.total_of_taxes)+"</td>";html+="</tr>";html+="<tr  class='moo_cart_total'>";html+="<td colspan='1' style='text-align: right;'>Total:</td>";html+="<td colspan='3'>$"+mooformatCentPrice(data.total)+"</td>";html+="</tr>";jQuery(".moo_cart_total").remove();jQuery(".moo_cart .CartContent>table").append(html)}else{moo_updateCart()}})}function moo_cart_DeleteItem(item){jQuery.post(moo_params.ajaxurl,{action:"moo_deleteItemFromcart",item:item},function(data){if(data.status!="success"){moo_updateCart()}});jQuery("#moo_cart_line_"+item).remove();jQuery(".MooLineModifier4_"+item).remove();delete MOO_CART[item];if(Object.keys(MOO_CART).length>0){moo_updateCartTotal()}else{jQuery(".moo_cart .CartContent>table>tbody").html('<tr><td colspan="4">Your Cart is empty !!</td></tr>');jQuery(".moo_cart_total").remove()}}function moo_emptyCart(event){event.preventDefault();swal("please wait..");jQuery.post(moo_params.ajaxurl,{action:"moo_emptycart"},function(data){if(data.status==="success"){var cart='<div class="moo_emptycart"><p>Your cart is empty</p><span><a class="moo-btn moo-btn-default" href="'+moo_params.storePage+'" style="margin-top: 30px;">Back to Main Menu</a></span></div>';jQuery(".moo-shopping-cart").html(cart);swal.close()}else{swal("Error, please try again, or refresh the page")}})}function moo_updateQuantityAndSI(item_uuid,qte,special_instruction){if(qte>1)jQuery.post(moo_params.ajaxurl,{action:"moo_update_qte",item:item_uuid,qte:qte});if(special_instruction!="")jQuery.post(moo_params.ajaxurl,{action:"moo_update_special_ins",item:item_uuid,special_ins:special_instruction})}function moo_recalculateCart(){jQuery("#moo-cart-total").html("Updating the total...");jQuery.post(moo_params.ajaxurl,{action:"moo_cart_getTotal"},function(totals){if(totals!==false){jQuery(".moo-totals-value").fadeOut(fadeTime,function(){jQuery("#moo-cart-subtotal").html("$"+mooformatCentPrice(totals.sub_total));jQuery("#moo-cart-tax").html("$"+mooformatCentPrice(totals.total_of_taxes));jQuery("#moo-cart-total").html("$"+mooformatCentPrice(totals.total));if(totals.total===0){jQuery(".moo-checkout").fadeOut(fadeTime)}else{jQuery(".moo-checkout").fadeIn(fadeTime)}jQuery(".moo-totals-value").fadeIn(fadeTime)})}else{var html='<div class="moo_emptycart"><p>Your cart is empty</p><span><a class="moo-btn moo-btn-default" href="'+moo_params.storePage+'" style="margin-top: 30px;">Back to Main Menu</a></span></div>';jQuery(".moo-shopping-cart").html(html)}})}function moo_updateQuantity(quantityInput,item_uuid){var productRow=jQuery(quantityInput).parent().parent();var price=parseFloat(productRow.children(".moo-product-price").text());var quantity=jQuery(quantityInput).val();var linePrice=price*quantity;jQuery.post(moo_params.ajaxurl,{action:"moo_update_qte",item:item_uuid,qte:quantity},function(data){if(data.status!="success"){swal({title:"Connection error",text:"Please refresh the page and try again",type:"error",confirmButtonText:"Try again "})}});productRow.children(".moo-product-line-price").each(function(){jQuery(this).fadeOut(fadeTime,function(){jQuery(this).text(formatPrice(linePrice.toFixed(2)));moo_recalculateCart();jQuery(this).fadeIn(fadeTime)})})}function moo_removeItem(removeButton,item_uuid){jQuery.post(moo_params.ajaxurl,{action:"moo_deleteItemFromcart",item:item_uuid},function(data){if(data.status!="success"){swal({title:"Connection error",text:"Please refresh the page and try again",type:"error",confirmButtonText:"Try again "})}});var productRow=jQuery(removeButton).parent().parent();productRow.slideUp(fadeTime,function(){productRow.remove();moo_recalculateCart()})}function formatPrice(p){return p.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}